(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-0ed5c824"],{"24a3":function(t,e,i){"use strict";e["a"]={methods:{getCarIncome:function(t){var e=t.destination_amount*t.fare_price;return t.car_income=e,e},getLadingSum:function(t){var e=+t.driver_tip_price+this.getCarIncome(t);return t.lading_total_value=e,e},getCargoDebt:function(t){var e=+t.association_price+ +t.bill_price+ +t.cargo_tip_price;return t.cargo_debt=e,e}}}},"6f5b":function(t,e,i){},7911:function(t,e,i){"use strict";var s=i("6f5b"),a=i.n(s);a.a},d999:function(t,e,i){"use strict";i.r(e);var s=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("m-form",{attrs:{title:"پرداخت رانندگان متفرقه",formName:"پرداخت رانندگان متفرقه",isEditing:t.isEditing,deletable:!0,showList:!1,showListBtn:!1,canDelete:t.canDelete,canSubmit:t.canSubmit&&!this.id,confirmBtnText:t.confirmBtnText,cancelConfirmBtnText:t.cancelConfirmBtnText,canConfirm:t.canConfirm,canCancelConfirm:t.canCancelConfirm},on:{"update:isEditing":function(e){t.isEditing=e},"update:is-editing":function(e){t.isEditing=e},cancelConfirm:t.cancelConfirm,confirm:t.confirm,goToForm:t.getItemByPosition,submit:t.openPaymentDialog,delete:t.deleteItem,clearForm:function(e){return t.clearForm()}},scopedSlots:t._u([{key:"header-btns",fn:function(){return[t.id?i("v-btn",{staticClass:"blue white--text mr-1",attrs:{target:"_blank",to:{name:"TransactionForm",params:{transactionType:"payment",id:t.item.payment.id}}}},[t._v(" مشاهده دریافت "),i("v-chip",{staticClass:"app-background-color mr-2",attrs:{"x-small":""}},[t._v(t._s(t.item.payment.code))])],1):t._e()]},proxy:!0}])},[[i("v-row",[i("v-col",{attrs:{cols:"12",md:"2"}},[i("v-text-field",{attrs:{label:"شماره",disabled:""},model:{value:t.item.code,callback:function(e){t.$set(t.item,"code",e)},expression:"item.code"}})],1),i("v-col",{attrs:{cols:"12",md:"6"}},[i("v-autocomplete",{attrs:{label:"حمل کننده",items:t.$store.state.drivings.filter((function(t){return"o"==t.car.owner})),"item-text":"title","item-value":"id",disabled:void 0!=this.id,"return-object":!0},on:{change:t.getDrivingData},model:{value:t.item.driving,callback:function(e){t.$set(t.item,"driving",e)},expression:"item.driving"}})],1),i("v-col",{attrs:{cols:"12",md:"2"}},[i("date",{attrs:{label:"تاریخ",default:!0,disabled:void 0!=this.id},model:{value:t.item.date,callback:function(e){t.$set(t.item,"date",e)},expression:"item.date"}})],1),i("v-col",{attrs:{cols:"2"}},[t.item.created_by?i("v-text-field",{attrs:{label:"ثبت کننده",disabled:""},model:{value:t.item.created_by.name,callback:function(e){t.$set(t.item.created_by,"name",e)},expression:"item.created_by.name"}}):t._e()],1),i("v-col",{attrs:{cols:"12",md:"12"}},[i("v-textarea",{attrs:{label:"توضیحات",disabled:void 0!=this.id},model:{value:t.item.explanation,callback:function(e){t.$set(t.item,"explanation",e)},expression:"item.explanation"}})],1),i("v-col",{attrs:{cols:"12"}},[i("div",{staticClass:"mb-1 mr-1"},[t._v("بارگیری ها")]),i("m-datatable",{attrs:{headers:t.ladingHeaders,items:t.ladings,"show-select":void 0==this.id,"item-key":"id","disable-pagination":!0,"hide-default-footer":!0,"show-export-btns":!1},scopedSlots:t._u([{key:"item.tipPrice",fn:function(e){var i=e.item;return[t._v(t._s(t._f("toMoney")(i.driver_tip_price)))]}},{key:"item.carIncome",fn:function(e){var i=e.item;return[t._v(t._s(t._f("toMoney")(t.getCarIncome(i))))]}},{key:"item.sum",fn:function(e){var i=e.item;return[t._v(t._s(t._f("toMoney")(t.getLadingSum(i))))]}},{key:"item.cargoDebt",fn:function(e){var i=e.item;return[t._v(t._s(t._f("toMoney")(t.getCargoDebt(i))))]}}]),model:{value:t.selectedLadings,callback:function(e){t.selectedLadings=e},expression:"selectedLadings"}})],1),i("v-col",{attrs:{cols:"12"}},[i("div",{staticClass:"mb-1 mr-1"},[t._v("تنخواه ها")]),i("m-datatable",{attrs:{headers:t.imprestHeaders,items:t.imprests,"show-select":void 0==this.id,"item-key":"id","disable-pagination":!0,"hide-default-footer":!0,"show-export-btns":!1},scopedSlots:t._u([{key:"item.paidValue",fn:function(e){var i=e.item;return[t._v(t._s(t._f("toMoney")(i.sanad.bed)))]}},{key:"item.receivedValue",fn:function(e){var i=e.item;return[t._v(t._s(t._f("toMoney")(t.getImprestSettledValue(i))))]}},{key:"item.remain",fn:function(e){var i=e.item;return[t._v(t._s(t._f("toMoney")(t.getImprestNotSettledValue(i))))]}}]),model:{value:t.selectedImprests,callback:function(e){t.selectedImprests=e},expression:"selectedImprests"}})],1),i("v-col",{attrs:{cols:"12",md:"4"}},[i("v-simple-table",{staticClass:"sum-table"},[i("tbody",[i("tr",[i("td",[t._v("جمع انعام")]),i("td",{staticClass:"ltr"},[t._v(t._s(t._f("toMoney")(t.tipsSum)))])]),i("tr",[i("td",[t._v("جمع درآمد ماشین")]),i("td",{staticClass:"ltr"},[t._v(t._s(t._f("toMoney")(t.carIncomesSum)))])]),i("tr",[i("td",[t._v("جمع")]),i("td",{staticClass:"ltr"},[t._v(t._s(t._f("toMoney")(t.ladingsSum)))])]),i("tr",[i("td",[t._v("مجموع بدهی باربری")]),i("td",{staticClass:"ltr"},[t._v(t._s(t._f("toMoney")(t.cargoDebtsSum)))])]),i("tr",[i("td",[t._v("مجموع تنخواه")]),i("td",{staticClass:"ltr"},[t._v(t._s(t._f("toMoney")(t.imprestsSum)))])]),i("tr",[i("td",{staticClass:"text--bold"},[t._v("مبلغ قابل پرداخت")]),i("td",{staticClass:"ltr"},[t._v(t._s(t._f("toMoney")(t.payableValue)))])])])])],1),i("v-dialog",{model:{value:t.paymentDialog,callback:function(e){t.paymentDialog=e},expression:"paymentDialog"}},[i("transaction-form",{ref:"transactionForm",attrs:{transactionType:"payment","modal-mode":!0,id:t.payment.id},on:{submit:t.validate}})],1)],1)]],2)},a=[],n=(i("4de4"),i("4160"),i("caad"),i("d81d"),i("13d5"),i("a434"),i("2532"),i("159b"),i("4633")),r=(i("3c1f"),i("0359"),i("f51a")),o=i("24a3"),c=i("da4b"),l=i("3915"),d={name:"DriverPaymentForm",mixins:[n["a"],r["a"],c["b"],o["a"]],components:{TransactionForm:l["default"]},props:["id"],data:function(){return{baseUrl:"dashtbashi/otherDriverPayments",leadingSlash:!0,permissionBasename:"otherDriverPayment",hasList:!1,hasIdProp:!0,paymentDialog:!1,payment:{},performClearForm:!0,ladingHeaders:[{text:"شماره حواله",value:"remittance.code"},{text:"تاریخ بارگیری",value:"lading_date"},{text:"تاریخ بارنامه",value:"bill_date"},{text:"نام پیمانکار",value:"contractor.name"},{text:"انعام",value:"tipPrice"},{text:"درآمد ماشین",value:"carIncome"},{text:"بدهی باربری",value:"cargoDebt"}],ladings:[],selectedLadings:[],imprestHeaders:[{text:"شماره",value:"code"},{text:"حساب",value:"account.name"},{text:"شناور",value:"floatAccount.name"},{text:"تاریخ",value:"transaction.date"},{text:"مبلغ پرداختی",value:"paidValue"},{text:"مبلغ دریافتی",value:"receivedValue"},{text:"مانده پرداخت نشده",value:"remain"}],imprests:[],selectedImprests:[]}},computed:{tipsSum:function(){return this.selectedLadings.reduce((function(t,e){return t+ +e.driver_tip_price}),0)},carIncomesSum:function(){var t=this;return this.selectedLadings.reduce((function(e,i){return e+t.getCarIncome(i)}),0)},ladingsSum:function(){var t=this;return this.selectedLadings.reduce((function(e,i){return e+t.getLadingSum(i)}),0)},cargoDebtsSum:function(){var t=this;return this.selectedLadings.reduce((function(e,i){return e+t.getCargoDebt(i)}),0)},imprestsSum:function(){var t=this;return this.selectedImprests.reduce((function(e,i){return e+ +t.getImprestNotSettledValue(i)}),0)},payableValue:function(){return this.ladingsSum-this.cargoDebtsSum-this.imprestsSum}},methods:{getImprestSettledValue:function(t){return t.imprestSettlements.reduce((function(t,e){return t+ +e.settled_value}),0)},getImprestNotSettledValue:function(t){return t.sanad.bed-this.getImprestSettledValue(t)},getData:function(){var t=this;this.getDrivings(!1,(function(e){var i=t.urlQuery["item.driving"];i&&(t.item.driving=e.filter((function(t){return t.id==i}))[0],t.getDrivingData(t.item.driving))}))},openPaymentDialog:function(){var t=this,e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.performClearForm=e,this.paymentDialog=!0,this.$nextTick((function(){t.$refs.transactionForm.setDefaults({"rows.0.value":t.payableValue})}))},getDrivingData:function(t){this.selectedLadings=[],this.selectedImprests=[],this.getDrivingLadings(t),this.getDriverNotSettledImprests(t)},getDrivingLadings:function(t){var e=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.request({url:this.endpoint("dashtbashi/ladings/"),method:"get",params:{driving:t.id,is_paid:!1},success:function(t){e.ladings=t,e.item.remittance&&(e.selectedLadings=e.ladings.filter((function(t){return t.remittance&&t.remittance.id==e.item.remittance&&e.item.selectedLadings.includes(String(t.id))}))),i&&i(t)}})},validate:function(t){this.payment=t;var e=t.items.items.reduce((function(t,e){return t+ +e.value}),0);e!=this.payableValue?this.notify("مبلغ پرداختی باید با مبلغ قابل پرداخت برابر باشد","danger"):this.paymentDialog=!1,this.submit(this.performClearForm)},getDriverNotSettledImprests:function(t){var e=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.request({url:this.endpoint("imprests/notSettledImprests"),params:{account:t.car.payableAccount,floatAccount:t.driver.floatAccount},method:"get",success:function(t){e.imprests=t,e.item.remittance&&(e.selectedImprests=e.imprests),i&&i(t)}})},getItemTemplate:function(){return{ladings:[],imprests:[]}},getRowTemplate:function(){return{tax_percent:this.getOptionValue("taxPercent")}},getItemByPosition:function(t){var e=this;return this.request({url:this.endpoint("dashtbashi/otherDriverPayments/byPosition"),method:"get",params:{id:this.id,position:t},success:function(t){e.setItem(t)}})},setItem:function(t){this.changeRouteTo(t.id),this.isEditing=!1,this.item=t,this.payment=t.payment,this.ladings=t.ladings,this.imprests=t.imprests,this.selectedLadings=t.ladings,this.selectedImprests=t.imprests},deleteRow:function(t){var e=this;if(-1==t)this.rows.forEach((function(t){t.id&&e.itemsToDelete.push(t.id)})),this.rows.splice(0,this.rows.length-1);else{var i=this.rows[t];i.id&&this.itemsToDelete.push(i.id),this.rows.splice(t,1)}},getSerialized:function(){var t={item:this.extractIds(this.item),payment:this.extractIds(this.payment)};return t.item.ladings=this.selectedLadings.map((function(t){return t.id})),t.item.imprests=this.selectedImprests.map((function(t){return t.id})),t.payment.account=this.item.driving.car.payableAccount,t.payment.floatAccount=this.item.driving.driver.floatAccount,t},clearForm:function(){this.isEditing=!0,this.item=this.getItemTemplate(),this.selectedLadings=[],this.selectedImprests=[],this.ladings=[],this.imprests=[],this.changeRouteTo(null),this.see}}},u=d,m=(i("7911"),i("2877")),v=i("6544"),h=i.n(v),f=i("c6a6"),p=i("8336"),g=i("cc20"),_=i("62ad"),b=i("169a"),y=i("0fd9"),x=i("1f4f"),D=i("8654"),I=i("a844"),C=Object(m["a"])(u,s,a,!1,null,"ad0f8eaa",null);e["default"]=C.exports;h()(C,{VAutocomplete:f["a"],VBtn:p["a"],VChip:g["a"],VCol:_["a"],VDialog:b["a"],VRow:y["a"],VSimpleTable:x["a"],VTextField:D["a"],VTextarea:I["a"]})},f51a:function(t,e,i){"use strict";i("d81d");e["a"]={data:function(){return{months:[{text:"فروردین",value:1},{text:"اردیبهشت",value:2},{text:"خرداد",value:3},{text:"تیر",value:4},{text:"مرداد",value:5},{text:"شهریور",value:6},{text:"مهر",value:7},{text:"آبان",value:8},{text:"آذر",value:9},{text:"دی",value:10},{text:"بهمن",value:11},{text:"اسفند",value:12}],tipPayers:[{title:"شرکت",id:"cmp"},{title:"پیمانکار",id:"cnt"}],remittancePaymentMethods:[{text:"کمیسیون و کرایه به شرکت",value:"tc"},{text:"کمیسیون به شرکت و کرایه به راننده",value:"tcd"},{text:"کمیسیون و کرایه با شرکت",value:"cp"}],receiveTypes:[{text:"نسیه",value:"cr"},{text:"نقدی",value:"cs"},{text:"کارت خوان",value:"p"}]}},methods:{getDrivers:function(t){var e=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(t||!this.$store.state.drivers.length)return this.request({url:this.endpoint("dashtbashi/drivers/"),method:"get",success:function(t){e.$store.commit("setDrivers",t),i&&i(t)}})},getCars:function(t){var e=this;if(t||!this.$store.state.cars.length)return this.request({url:this.endpoint("dashtbashi/cars/"),method:"get",success:function(t){e.$store.commit("setCars",t)}})},getDrivings:function(t){var e=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(t||!this.$store.state.drivings.length)return this.request({url:this.endpoint("dashtbashi/drivings/"),method:"get",success:function(t){e.$store.commit("setDrivings",t),i&&i(t)}});i&&i(this.$store.state.drivings)},getAssociations:function(t){var e=this;if(t||!this.$store.state.associations.length)return this.request({url:this.endpoint("dashtbashi/associations/"),method:"get",success:function(t){e.$store.commit("setAssociations",t)}})},getRemittances:function(t){var e=this;this.request({url:this.endpoint("dashtbashi/remittances/?limit=10&offset=0"),method:"get",params:{code__icontains:t},success:function(t){e.remittances=t["results"].map((function(t){return t.code=String(t.code),t}))}})}}}}}]);
//# sourceMappingURL=chunk-0ed5c824.380e04cd.js.map