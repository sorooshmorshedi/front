(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-a4f8b4aa"],{"0a0f":function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-card",[a("v-card-title",[t._v("گزارش مبلغ قابل پرداخت به رانندگان متفرقه")]),a("v-card-text",[a("v-row",[a("v-col",{attrs:{cols:"12",md:"3"}},[a("v-autocomplete",{attrs:{"return-object":!0,label:"شماره حواله",items:t.remittances,"search-input":t.remittanceSearch,"item-text":"code","item-value":"id",clearable:"",multiple:!1},on:{"update:searchInput":function(e){t.remittanceSearch=e},"update:search-input":function(e){t.remittanceSearch=e},change:t.getRemittanceData},model:{value:t.remittance,callback:function(e){t.remittance=e},expression:"remittance"}})],1),t.remittance?[a("v-col",{attrs:{cols:"12",md:"3"}},[a("account-select",{attrs:{label:"پیمانکار",disabled:!0},model:{value:t.remittance.contractor,callback:function(e){t.$set(t.remittance,"contractor",e)},expression:"remittance.contractor"}})],1),a("v-col",{attrs:{cols:"12",md:"3"}},[a("date",{attrs:{label:"از تاریخ"},model:{value:t.filters.fromDate,callback:function(e){t.$set(t.filters,"fromDate",e)},expression:"filters.fromDate"}})],1),a("v-col",{attrs:{cols:"12",md:"3"}},[a("date",{attrs:{label:"تا تاریخ"},model:{value:t.filters.toDate,callback:function(e){t.$set(t.filters,"toDate",e)},expression:"filters.toDate"}})],1)]:t._e(),a("v-col",{attrs:{cols:"12"}},[t.remittance?a("v-data-table",{attrs:{headers:t.tableHeaders,items:t.items,"item-key":"id","disable-pagination":!0,"hide-default-footer":!0},scopedSlots:t._u([{key:"item.carIncome",fn:function(e){var a=e.item;return[t._v(t._s(t._f("toMoney")(a.carIncome)))]}},{key:"item.imprestSum",fn:function(e){var a=e.item;return[t._v(t._s(t._f("toMoney")(a.imprestSum)))]}},{key:"item.cargoDebt",fn:function(e){var a=e.item;return[t._v(t._s(t._f("toMoney")(a.cargoDebt)))]}},{key:"item.tipPrice",fn:function(e){var a=e.item;return[t._v(t._s(t._f("toMoney")(a.tipPrice)))]}},{key:"item.payableValue",fn:function(e){var i=e.item;return[a("span",{staticClass:"ltr d-inline-block"},[t._v(t._s(t._f("toMoney")(i.payableValue)))])]}},{key:"item.pay",fn:function(e){var i=e.item;return[i.sumRow?t._e():a("v-btn",{attrs:{to:{name:"DriverPayment",query:{"item.driving":i.driving.id,"item.remittance":t.remittance.id,"item.selectedLadings":i.selectedLadings}},color:"blue white--text"}},[t._v("پرداخت")])]}}],null,!1,4217167801)}):t._e()],1)],2)],1)],1)},r=[],n=(a("4de4"),a("13d5"),a("b85c")),s=a("4633"),c=(a("3c1f"),a("0359"),a("f51a")),o=(a("da4b"),a("3915")),u=a("24a3"),l={name:"Form",mixins:[s["a"],c["a"],u["a"]],components:{TransactionForm:o["default"]},props:["id"],data:function(){return{remittances:[],remittanceSearch:"",remittance:null,filters:{},tableHeaders:[{text:"حمل کننده",value:"driving.title"},{text:"جمع انعام",value:"tipPrice"},{text:"جمع درآمد ماشین",value:"carIncome"},{text:"جمع بدهی باربری",value:"cargoDebt"},{text:"جمع تنخواه",value:"imprestSum"},{text:"مبلغ قابل پرداخت",value:"payableValue"},{text:"پرداخت",value:"pay"}],data:{ladings:[],imprests:[]}}},computed:{items:function(){var t,e=this,a=[],i=Object(n["a"])(this.data.ladings);try{var r=function(){var i=t.value,r=i.driving,n=a.filter((function(t){return t.driving.id==r.id}));return 0!=n.length?(n=n[0],n.ladings=i):(n={driving:r,ladings:[i],selectedLadings:[],imprests:[],tipPrice:0,carIncome:0,cargoDebt:0,ladingSum:0,imprestSum:0,payableValue:0},a.push(n)),n.cargoDebt+=e.getCargoDebt(i),e.filters.fromDate&&i.lading_date<e.filters.fromDate||e.filters.toDate&&i.lading_date>e.filters.toDate?"continue":(n.tipPrice+=+i.driver_tip_price,n.carIncome+=e.getCarIncome(i),n.ladingSum+=e.getLadingSum(i),void n.selectedLadings.push(i.id))};for(i.s();!(t=i.n()).done;)r()}catch(h){i.e(h)}finally{i.f()}var s,c=Object(n["a"])(this.data.imprests);try{for(c.s();!(s=c.n()).done;){var o=s.value;a[0].imprests.push(o);var u=o.items.reduce((function(t,e){return t+ +e.value}),0),l=o.imprestSettlements.reduce((function(t,e){return t+ +e.settled_value}),0),m=u-l;a[0].imprestSum+=m}}catch(h){c.e(h)}finally{c.f()}for(var d=0,v=a;d<v.length;d++){var f=v[d];f.payableValue=f.ladingSum-f.cargoDebt-f.imprestSum}return a}},created:function(){},watch:{remittanceSearch:function(){this.getRemittances(this.remittanceSearch)}},methods:{getRemittanceData:function(){var t=this;this.remittance&&this.request({url:this.endpoint("dashtbashi/report/otherDriverPayments"),params:{remittance:this.remittance.id},method:"get",success:function(e){t.data=e}})}}},m=l,d=(a("be55"),a("2877")),v=a("6544"),f=a.n(v),h=a("c6a6"),p=a("8336"),g=a("b0af"),b=a("99d9"),_=a("62ad"),x=a("8fea"),y=a("0fd9"),D=Object(d["a"])(m,i,r,!1,null,"3e5b42de",null);e["default"]=D.exports;f()(D,{VAutocomplete:h["a"],VBtn:p["a"],VCard:g["a"],VCardText:b["b"],VCardTitle:b["c"],VCol:_["a"],VDataTable:x["a"],VRow:y["a"]})},"0dfa":function(t,e,a){},"24a3":function(t,e,a){"use strict";e["a"]={methods:{getCarIncome:function(t){var e=t.destination_amount*t.fare_price;return t.car_income=e,e},getLadingSum:function(t){var e=+t.driver_tip_price+this.getCarIncome(t);return t.lading_total_value=e,e},getCargoDebt:function(t){var e=+t.association_price+ +t.bill_price+ +t.cargo_tip_price;return t.cargo_debt=e,e}}}},be55:function(t,e,a){"use strict";var i=a("0dfa"),r=a.n(i);r.a},f51a:function(t,e,a){"use strict";a("d81d");e["a"]={data:function(){return{months:[{text:"فروردین",value:1},{text:"اردیبهشت",value:2},{text:"خرداد",value:3},{text:"تیر",value:4},{text:"مرداد",value:5},{text:"شهریور",value:6},{text:"مهر",value:7},{text:"آبان",value:8},{text:"آذر",value:9},{text:"دی",value:10},{text:"بهمن",value:11},{text:"اسفند",value:12}],tipPayers:[{title:"شرکت",id:"cmp"},{title:"پیمانکار",id:"cnt"}],remittancePaymentMethods:[{text:"کمیسیون و کرایه به شرکت",value:"tc"},{text:"کمیسیون به شرکت و کرایه به راننده",value:"tcd"},{text:"کمیسیون و کرایه با شرکت",value:"cp"}],receiveTypes:[{text:"نسیه",value:"cr"},{text:"نقدی",value:"cs"},{text:"کارت خوان",value:"p"}]}},methods:{getDrivers:function(t){var e=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(t||!this.$store.state.drivers.length)return this.request({url:this.endpoint("dashtbashi/drivers/"),method:"get",success:function(t){e.$store.commit("setDrivers",t),a&&a(t)}})},getCars:function(t){var e=this;if(t||!this.$store.state.cars.length)return this.request({url:this.endpoint("dashtbashi/cars/"),method:"get",success:function(t){e.$store.commit("setCars",t)}})},getDrivings:function(t){var e=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(t||!this.$store.state.drivings.length)return this.request({url:this.endpoint("dashtbashi/drivings/"),method:"get",success:function(t){e.$store.commit("setDrivings",t),a&&a(t)}});a&&a(this.$store.state.drivings)},getAssociations:function(t){var e=this;if(t||!this.$store.state.associations.length)return this.request({url:this.endpoint("dashtbashi/associations/"),method:"get",success:function(t){e.$store.commit("setAssociations",t)}})},getRemittances:function(t){var e=this;this.request({url:this.endpoint("dashtbashi/remittances/?limit=10&offset=0"),method:"get",params:{code__icontains:t},success:function(t){e.remittances=t["results"].map((function(t){return t.code=String(t.code),t}))}})}}}}}]);
//# sourceMappingURL=chunk-a4f8b4aa.b8efe440.js.map